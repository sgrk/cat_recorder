# 猫検出録画システム仕様書

## 📝 システム概要

外部カメラからの映像を常時録画し、1分間の動画ファイルとして保存します。保存された動画からフレームを抽出し、YOLOモデルで猫（class 0）を検出します。検出結果に基づき、動画を「猫動画フォルダ」へ移動または削除します。また、Web UIを通じてモデルや設定の管理を行います。

## 📷 カメラ映像の録画と保存

- 録画方法: OpenCVのcv2.VideoCapture()を使用して外部カメラから映像を取得し、cv2.VideoWriter()で1分間の動画ファイルとして保存します。
- 保存形式: 動画はMP4形式で保存します。
- 保存先フォルダ: 指定されたフォルダに動画を保存します。
- 容量管理: 保存先フォルダの合計容量が1GBを超えた場合、古い動画ファイルから順に削除し、1GB以内に収めます。

## 🐱 猫の検出と動画の分類

- フレーム抽出: 保存された動画から30フレームおきに画像を抽出します。
- 物体検出: Ultralytics YOLOモデル（例: yolov8n.pt）を使用して、抽出した画像で猫（class 0）の検出を行います。
- 分類条件: 抽出した画像のうち、猫が検出された画像の割合が50%以上の場合、その動画を「猫動画フォルダ」へ移動します。そうでない場合は動画を削除します。

## 🌐 Web UIによる管理機能

- モデル管理: YOLOモデルファイルのアップロードや切り替えを行います。
- 設定変更: 以下の設定をWeb UIから変更可能です。
  - 保存先フォルダのパス
  - 容量制限（例: 1GB）
  - フレーム抽出間隔（例: 30フレーム）
  - 猫検出の閾値（例: 50%）
- ステータス表示: 現在の録画状況、保存容量、検出結果などをリアルタイムで表示します。

## 🛠 使用技術

- プログラミング言語: Python
- ライブラリ:
  - OpenCV: 映像の取得と保存
  - Ultralytics YOLO: 物体検出
  - FlaskまたはFastAPI: Web UIの構築

## 📁 ディレクトリ構成（例）

```
project_root/
├── recordings/             # 一時的な動画保存フォルダ
├── cat_videos/            # 猫が検出された動画の保存フォルダ
├── models/                # YOLOモデルファイルの保存フォルダ
├── app.py                 # メインアプリケーション
├── config.yaml            # 設定ファイル
└── templates/             # Web UIのテンプレート
```

## 🔄 処理フロー

1. 外部カメラから映像を取得し、1分間の動画ファイルとして保存します。
2. 保存先フォルダの容量をチェックし、1GBを超えている場合は古い動画ファイルを削除します。
3. 保存された動画から30フレームおきに画像を抽出します。
4. 抽出した画像をYOLOモデルで推論し、猫（class 0）の検出を行います。
5. 猫が検出された画像の割合が50%以上の場合、その動画を「猫動画フォルダ」へ移動します。そうでない場合は動画を削除します。
6. Web UIを通じて、モデルや設定の管理、ステータスの確認を行います。